<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Dashboard - Java Connection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #1a472a;
            --secondary-color: #2e8b57;
            --accent-color: #d4af37;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --light-bg: #f5f5f5;
            --dark-bg: #1e2a1e;
            --border-color: #d1d7dc;
            --text-color: #2c3e50;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --hover-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo-main {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-image {
            height: 50px;
            max-width: 200px;
            object-fit: contain;
        }

        .logo-sub {
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.85);
            margin-top: 2px;
        }

        nav {
            display: flex;
            gap: 24px;
        }

        .nav-link {
            color: rgba(255,255,255,0.85);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .nav-link i {
            font-size: 16px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-size: 28px;
            margin-bottom: 24px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 8px;
        }

        h2 i {
            color: var(--secondary-color);
        }

        h3 {
            font-size: 20px;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border-left: 4px solid var(--accent-color);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }

        .kpi-card.success::before {
            background: var(--success-color);
        }

        .kpi-card.danger::before {
            background: var(--danger-color);
        }

        .kpi-card.warning::before {
            background: var(--warning-color);
        }

        .kpi-card.info::before {
            background: var(--info-color);
        }

        .kpi-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--primary-color);
        }

        .kpi-change {
            font-size: 12px;
            color: #6c757d;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--light-bg);
            font-weight: 600;
            color: var(--primary-color);
        }

        tr:hover {
            background: rgba(26, 71, 42, 0.05);
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-accent {
            background: var(--accent-color);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success-color);
        }

        .badge-danger {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .badge-warning {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .badge-info {
            background: rgba(52, 152, 219, 0.2);
            color: var(--info-color);
        }

        .badge-accent {
            background: rgba(212, 175, 55, 0.2);
            color: var(--accent-color);
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex-grow: 1;
            height: 8px;
            background: var(--light-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-success {
            background: var(--success-color);
        }

        .progress-warning {
            background: var(--warning-color);
        }

        .progress-danger {
            background: var(--danger-color);
        }

        .progress-accent {
            background: var(--accent-color);
        }

        .progress-text {
            font-size: 14px;
            font-weight: 600;
            min-width: 40px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 71, 42, 0.2);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 32px;
            border-radius: 12px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.3s ease;
            border-top: 4px solid var(--accent-color);
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(39, 174, 96, 0.15);
            color: #0d6c3a;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: rgba(231, 76, 60, 0.15);
            color: #a13c30;
            border-left: 4px solid var(--danger-color);
        }

        .risk-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            border-left: 4px solid var(--warning-color);
        }

        .risk-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--warning-color);
            margin-bottom: 12px;
        }

        .recommendation-item {
            padding: 12px 16px;
            background: var(--light-bg);
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendation-priority {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .priority-high {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .priority-medium {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .priority-low {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success-color);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .process-tracker {
            margin: 20px 0;
        }

        .process-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: 30px 0;
        }

        .process-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--light-bg);
            z-index: 1;
        }

        .process-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            width: 100px;
        }

        .step-icon {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .step-completed .step-icon {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .step-active .step-icon {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step-label {
            font-size: 12px;
            text-align: center;
            color: #6c757d;
        }

        .step-completed .step-label {
            color: var(--success-color);
            font-weight: 600;
        }

        .step-active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .process-connector {
            position: absolute;
            top: 15px;
            left: 0;
            height: 4px;
            background: var(--success-color);
            z-index: 1;
            transition: width 0.5s ease;
        }

        .quantity-tracking {
            margin-top: 20px;
        }

        .quantity-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .quantity-table th, .quantity-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .quantity-table th {
            background: var(--light-bg);
        }

        .process-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-completed {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success-color);
        }

        .status-in-progress {
            background: rgba(26, 71, 42, 0.2);
            color: var(--primary-color);
        }

        .status-pending {
            background: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }

        .chart-container {
            height: 300px;
            margin: 20px 0;
            position: relative;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
        }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-full {
            grid-column: 1 / -1;
        }

        .dss-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .dss-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border-left: 4px solid var(--accent-color);
        }

        .dss-card.risk::before {
            background: var(--danger-color);
        }

        .dss-card.forecast::before {
            background: var(--warning-color);
        }

        .dss-card.efficiency::before {
            background: var(--success-color);
        }

        .dss-card h4 {
            margin-bottom: 12px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dss-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .dss-tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .dss-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--accent-color);
        }

        .dss-tab-content {
            display: none;
        }

        .dss-tab-content.active {
            display: block;
        }

        footer {
            background: var(--primary-color);
            color: white;
            padding: 24px;
            margin-top: 40px;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-logo {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .footer-logo-main {
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-logo-image {
            height: 35px;
            max-width: 150px;
            object-fit: contain;
        }

        .footer-logo-sub {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }

        .footer-info {
            text-align: right;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }

        .efficiency-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .efficiency-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--info-color);
        }

        .efficiency-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .efficiency-title {
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .efficiency-input {
            width: 80px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
        }

        .criteria-list {
            font-size: 14px;
            color: #6c757d;
            margin-top: 12px;
        }

        .criteria-list ul {
            margin-left: 20px;
        }

        .criteria-list li {
            margin-bottom: 4px;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .export-option {
            padding: 16px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .export-option:hover {
            border-color: var(--primary-color);
            background: rgba(26, 71, 42, 0.05);
        }

        .logo-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .logo-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(26, 71, 42, 0.05);
        }

        .logo-upload-area i {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 16px;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 80px;
            margin: 0 auto 20px;
            display: none;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        @media (max-width: 1200px) {
            .dashboard-grid, .dss-grid, .efficiency-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .chart-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid, .dss-grid, .efficiency-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            nav {
                gap: 16px;
            }

            header {
                padding: 0 16px;
                flex-direction: column;
                height: auto;
                padding: 16px;
            }

            .logo-container {
                margin-bottom: 16px;
            }

            .container {
                padding: 16px;
            }

            .process-steps {
                overflow-x: auto;
                justify-content: flex-start;
                padding-bottom: 10px;
            }

            .process-step {
                min-width: 90px;
            }

            .footer-content {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .footer-logo, .footer-info {
                align-items: center;
                text-align: center;
            }

            .dss-tabs {
                flex-direction: column;
            }

            .dss-tab {
                text-align: center;
            }

            .export-options {
                grid-template-columns: 1fr;
            }

            .logo-image {
                height: 40px;
                max-width: 150px;
            }
        }

        @media (max-width: 576px) {
            nav {
                flex-wrap: wrap;
                justify-content: center;
            }

            .modal-content {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo-container">
            <div class="logo-main">
                <img id="header-logo-image" class="logo-image" alt="Company Logo" style="display: none;">
                <span id="company-name" style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-industry"></i>
                    Java CONNECTION
                </span>
            </div>
            <div class="logo-sub" id="company-tagline">EXPORT & WHOLESALE</div>
        </div>
        <nav>
            <a class="nav-link active" onclick="showTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a class="nav-link" onclick="showTab('orders')">
                <i class="fas fa-clipboard-list"></i> Orders
            </a>
            <a class="nav-link" onclick="showTab('tracking')">
                <i class="fas fa-map-marker-alt"></i> Tracking
            </a>
            <a class="nav-link" onclick="showTab('dss')">
                <i class="fas fa-chart-line"></i> DSS Analysis
            </a>
            <a class="nav-link" onclick="showTab('efficiency')">
                <i class="fas fa-cogs"></i> Efficiency
            </a>
            <a class="nav-link" onclick="openExportModal()">
                <i class="fas fa-file-export"></i> Export
            </a>
            <a class="nav-link" onclick="openLogoModal()">
                <i class="fas fa-palette"></i> Custom Logo
            </a>
        </nav>
    </header>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2><i class="fas fa-tachometer-alt"></i> Production Dashboard</h2>

            <!-- KPI Cards -->
            <div class="dashboard-grid">
                <div class="kpi-card success">
                    <div class="kpi-label">
                        <i class="fas fa-clipboard-list"></i> Total Orders
                    </div>
                    <div class="kpi-value" id="total-orders">0</div>
                    <div class="kpi-change">This Month</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-label">
                        <i class="fas fa-spinner"></i> In Progress
                    </div>
                    <div class="kpi-value" id="in-progress">0</div>
                    <div class="kpi-change">Active Orders</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">
                        <i class="fas fa-check-circle"></i> Completed
                    </div>
                    <div class="kpi-value" id="completed-orders">0%</div>
                    <div class="kpi-change">Completion Rate</div>
                </div>
                <div class="kpi-card danger">
                    <div class="kpi-label">
                        <i class="fas fa-exclamation-triangle"></i> At Risk
                    </div>
                    <div class="kpi-value" id="at-risk">0</div>
                    <div class="kpi-change">Critical Orders</div>
                </div>
            </div>

            <!-- Bottleneck Alert -->
            <div id="bottleneck-alert" style="margin-bottom: 24px;"></div>

            <!-- At-Risk Orders -->
            <div class="table-container" style="margin-bottom: 24px;">
                <div style="padding: 20px; border-bottom: 1px solid var(--border-color);">
                    <h3><i class="fas fa-exclamation-circle"></i> Orders at Risk</h3>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Risk Level</th>
                            <th>Risk Score</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="risk-orders-table">
                        <tr><td colspan="5" style="text-align: center; color: #6c757d;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- KPI Metrics -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                <div class="kpi-card">
                    <div class="kpi-label">
                        <i class="fas fa-clock"></i> Avg Lead Time
                    </div>
                    <div class="kpi-value" id="avg-lead-time" style="font-size: 28px;">-</div>
                    <div class="kpi-change">hours</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        <i class="fas fa-bug"></i> Defect Rate
                    </div>
                    <div class="kpi-value" id="defect-rate" style="font-size: 28px;">-</div>
                    <div class="kpi-change">percent</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        <i class="fas fa-tachometer-alt"></i> Bottleneck
                    </div>
                    <div class="kpi-value" id="bottleneck-stage" style="font-size: 20px;">-</div>
                    <div class="kpi-change" id="bottleneck-risk">-</div>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2><i class="fas fa-clipboard-list"></i> Orders Management</h2>
                <button class="btn btn-primary" onclick="openOrderModal()">
                    <i class="fas fa-plus"></i> New Order
                </button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Qty</th>
                            <th>Order Date</th>
                            <th>Target Date</th>
                            <th>Status</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table">
                        <tr><td colspan="9" style="text-align: center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tracking Tab -->
        <div id="tracking" class="tab-content">
            <h2><i class="fas fa-map-marker-alt"></i> Production Tracking</h2>

            <div class="table-container">
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label><i class="fas fa-search"></i> Select Order</label>
                        <select id="track-order-select" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="loadOrderTracking()">
                            <option value="">-- Select Order --</option>
                        </select>
                    </div>

                    <div id="order-tracking-info" style="display: none;">
                        <div class="process-tracker">
                            <h3>Production Process</h3>
                            <div class="process-steps" id="process-steps">
                                <!-- Process steps will be dynamically generated here -->
                            </div>
                        </div>

                        <div class="quantity-tracking">
                            <h3>Quantity Tracking</h3>
                            <div id="quantity-tracking-table">
                                <!-- Quantity tracking table will be generated here -->
                            </div>
                        </div>

                        <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                            <h3>Update Process Status</h3>
                            <form id="tracking-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Process</label>
                                        <select id="track-process-select" name="process" required>
                                            <!-- Process options will be dynamically generated -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Quantity Completed</label>
                                        <input type="number" id="quantity-completed" name="quantity_completed" min="0" value="0" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Defect Quantity</label>
                                        <input type="number" id="defect-quantity" name="defect_quantity" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label>PIC Name</label>
                                        <input type="text" name="pic_name" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Start Time</label>
                                        <input type="datetime-local" name="start_time" id="start-time" required>
                                    </div>
                                    <div class="form-group">
                                        <label>End Time</label>
                                        <input type="datetime-local" name="end_time" id="end-time">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Issues/Notes</label>
                                    <textarea name="issues"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Update Tracking
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DSS Analysis Tab -->
        <div id="dss" class="tab-content">
            <h2><i class="fas fa-chart-line"></i> Decision Support System Analysis</h2>

            <div class="dss-tabs">
                <div class="dss-tab active" onclick="showDssTab('single')">Single Order Analysis</div>
                <div class="dss-tab" onclick="showDssTab('combined')">Combined Analysis</div>
            </div>

            <!-- Single Order Analysis -->
            <div id="dss-single" class="dss-tab-content active">
                <div class="table-container" style="margin-bottom: 24px;">
                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label><i class="fas fa-search"></i> Select Order for Analysis</label>
                            <select id="dss-order-select" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="analyzeOrder()">
                                <option value="">-- Select Order --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="dss-results"></div>
            </div>

            <!-- Combined Analysis -->
            <div id="dss-combined" class="dss-tab-content">
                <div class="table-container" style="margin-bottom: 24px;">
                    <div style="padding: 20px;">
                        <h3><i class="fas fa-chart-bar"></i> Overall Production Analysis</h3>
                        <p>Comprehensive analysis of all production orders and processes</p>
                        <button class="btn btn-primary" onclick="analyzeAllOrders()">
                            <i class="fas fa-sync-alt"></i> Refresh Analysis
                        </button>
                    </div>
                </div>

                <div id="combined-results"></div>
            </div>
        </div>

        <!-- Efficiency Tab -->
        <div id="efficiency" class="tab-content">
            <h2><i class="fas fa-cogs"></i> Process Efficiency Settings</h2>
            <p style="margin-bottom: 24px; color: #6c757d;">
                Adjust efficiency targets for each production process. Efficiency is calculated based on time, quality, and output metrics.
            </p>

            <div class="efficiency-grid" id="efficiency-settings">
                <!-- Efficiency settings will be loaded here -->
            </div>

            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-primary" onclick="saveEfficiencySettings()">
                    <i class="fas fa-save"></i> Save Efficiency Settings
                </button>
                <button class="btn" onclick="resetEfficiencySettings()" style="background: var(--light-bg);">
                    <i class="fas fa-undo"></i> Reset to Default
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <div class="footer-logo-main">
                    <img id="footer-logo-image" class="footer-logo-image" alt="Company Logo" style="display: none;">
                    <span id="footer-company-name">Java CONNECTION</span>
                </div>
                <div class="footer-logo-sub" id="footer-company-tagline">EXPORT & WHOLESALE</div>
            </div>
            <div class="footer-info">
                <p>Production Management System &copy; 2023</p>
                <p>Optimizing your manufacturing process</p>
            </div>
        </div>
    </footer>

    <!-- Order Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modal-title">Create New Order</span>
                <button class="modal-close" onclick="closeOrderModal()">&times;</button>
            </div>
            <form id="order-form">
                <input type="hidden" id="order-id" name="order_id">
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" name="customer_name" required>
                </div>
                <div class="form-group">
                    <label>Product Description</label>
                    <input type="text" name="product_description" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" name="quantity" id="order-quantity" required min="1">
                    </div>
                    <div class="form-group">
                        <label>Order Date</label>
                        <input type="date" name="order_date" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Target Date</label>
                        <input type="date" name="target_date" required>
                    </div>
                    <div class="form-group">
                        <label>PIC Name</label>
                        <input type="text" name="pic_name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Special Requirements</label>
                    <div style="display: flex; gap: 16px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" name="requires_accessories" id="requires-accessories">
                            <span>Requires Accessories</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 6px;">
                            <input type="checkbox" name="requires_welding" id="requires-welding">
                            <span>Requires Welding</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea name="notes"></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary" id="submit-button">Create Order</button>
                    <button type="button" class="btn" onclick="closeOrderModal()" style="background: var(--light-bg);">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <span>Export Data</span>
                <button class="modal-close" onclick="closeExportModal()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 16px;">Select Data to Export</h3>
                
                <div class="export-options">
                    <div class="export-option" onclick="exportToExcel('orders')">
                        <i class="fas fa-clipboard-list" style="font-size: 32px; color: var(--primary-color); margin-bottom: 8px;"></i>
                        <h4>Orders Data</h4>
                        <p>Export all order information</p>
                    </div>
                    
                    <div class="export-option" onclick="exportToExcel('tracking')">
                        <i class="fas fa-map-marker-alt" style="font-size: 32px; color: var(--info-color); margin-bottom: 8px;"></i>
                        <h4>Tracking Data</h4>
                        <p>Export production tracking details</p>
                    </div>
                    
                    <div class="export-option" onclick="exportToExcel('efficiency')">
                        <i class="fas fa-chart-line" style="font-size: 32px; color: var(--success-color); margin-bottom: 8px;"></i>
                        <h4>Efficiency Report</h4>
                        <p>Export process efficiency analysis</p>
                    </div>
                    
                    <div class="export-option" onclick="exportToExcel('all')">
                        <i class="fas fa-file-excel" style="font-size: 32px; color: var(--accent-color); margin-bottom: 8px;"></i>
                        <h4>Complete Report</h4>
                        <p>Export all data in one file</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 16px; background: var(--light-bg); border-radius: 8px;">
                    <h4><i class="fas fa-info-circle"></i> Export Information</h4>
                    <p style="margin-top: 8px; font-size: 14px;">
                        Data will be exported in Excel format. The export includes current data from the production dashboard.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Logo Customization Modal -->
    <div id="logoModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <span>Upload Company Logo</span>
                <button class="modal-close" onclick="closeLogoModal()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div class="logo-upload-area" id="logo-upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Upload Logo Image</h4>
                    <p>Click to browse or drag & drop</p>
                    <p style="font-size: 12px; color: #6c757d; margin-top: 8px;">
                        Recommended: PNG with transparent background, max 500KB
                    </p>
                    <input type="file" id="logo-file-input" accept="image/*" style="display: none;">
                </div>

                <div class="logo-preview" id="logo-preview">
                    <img id="logo-preview-image" src="" alt="Logo Preview">
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="button" class="btn btn-primary" onclick="saveCompanyLogo()">
                        <i class="fas fa-save"></i> Save Logo
                    </button>
                    <button type="button" class="btn btn-danger" onclick="removeCompanyLogo()">
                        <i class="fas fa-trash"></i> Remove Logo
                    </button>
                    <button type="button" class="btn" onclick="closeLogoModal()" style="background: var(--light-bg);">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Messages -->
    <div id="alert-container" style="position: fixed; top: 80px; right: 24px; z-index: 999; max-width: 400px;"></div>

    <script>
        // Production processes definition
        const productionProcesses = [
            { id: 'warehouse_in', name: 'Gudang Masuk', icon: 'fa-box' },
            { id: 'sanding', name: 'Amplas', icon: 'fa-sandpaper' },
            { id: 'assembly', name: 'Perakitan', icon: 'fa-tools' },
            { id: 'coloring', name: 'Pewarnaan', icon: 'fa-fill-drip' },
            { id: 'accessories', name: 'Aksesoris', icon: 'fa-puzzle-piece', optional: true },
            { id: 'welding', name: 'Las', icon: 'fa-fire', optional: true },
            { id: 'inspection', name: 'Inspeksi', icon: 'fa-search' },
            { id: 'coating', name: 'Pelapisan', icon: 'fa-layer-group' },
            { id: 'packaging', name: 'Packaging & Kode', icon: 'fa-box-open' },
            { id: 'warehouse_out', name: 'Gudang Akhir', icon: 'fa-warehouse' }
        ];

        // Default efficiency settings
        const defaultEfficiencySettings = {
            warehouse_in: { name: 'Gudang Masuk', targetTime: 2, targetQuality: 99, targetOutput: 100, criteria: ["Waktu bongkar muat maksimal 2 jam", "Akurasi data barang masuk 99%", "Tidak ada kerusakan selama handling"] },
            sanding: { name: 'Amplas', targetTime: 4, targetQuality: 95, targetOutput: 90, criteria: ["Permukaan halus tanpa cacat", "Waktu proses sesuai spesifikasi material", "Penggunaan amplas optimal"] },
            assembly: { name: 'Perakitan', targetTime: 6, targetQuality: 97, targetOutput: 95, criteria: ["Presisi komponen sesuai desain", "Kekuatan sambungan terjamin", "Waktu assembly sesuai kompleksitas"] },
            coloring: { name: 'Pewarnaan', targetTime: 3, targetQuality: 98, targetOutput: 92, criteria: ["Konsistensi warna merata", "Ketebalan coating sesuai standar", "Waktu drying optimal"] },
            accessories: { name: 'Aksesoris', targetTime: 2, targetQuality: 96, targetOutput: 94, criteria: ["Pemasangan aksesoris presisi", "Kesesuaian dengan desain", "Fungsi aksesoris terjamin"] },
            welding: { name: 'Las', targetTime: 5, targetQuality: 95, targetOutput: 88, criteria: ["Kekuatan las memenuhi standar", "Keamanan proses pengelasan", "Finishing hasil las rapi"] },
            inspection: { name: 'Inspeksi', targetTime: 1, targetQuality: 100, targetOutput: 100, criteria: ["Pemeriksaan menyeluruh semua komponen", "Dokumentasi hasil inspeksi", "Standar kualitas terpenuhi"] },
            coating: { name: 'Pelapisan', targetTime: 4, targetQuality: 97, targetOutput: 90, criteria: ["Ketebalan lapisan seragam", "Daya tahan coating optimal", "Waktu aplikasi efisien"] },
            packaging: { name: 'Packaging & Kode', targetTime: 2, targetQuality: 99, targetOutput: 98, criteria: ["Keamanan packaging terjamin", "Label dan kode akurat", "Efisiensi waktu packaging"] },
            warehouse_out: { name: 'Gudang Akhir', targetTime: 1, targetQuality: 100, targetOutput: 100, criteria: ["Akurasi data barang keluar", "Keamanan penyimpanan", "Efisiensi penanganan pengiriman"] }
        };

        // Sample orders data
        let orders = [
            {
                order_id: 'ORD-001',
                customer_name: 'PT Maju Jaya',
                product_description: 'Meja Kerja Kayu',
                quantity: 5,
                order_date: '2023-10-01',
                target_date: '2023-10-20',
                pic_name: 'Budi Santoso',
                current_status: 'in_progress',
                notes: 'Prioritas tinggi',
                requires_accessories: true,
                requires_welding: false,
                progress: 40,
                risk_level: 'MEDIUM',
                risk_score: 60,
                tracking: [
                    { process: 'warehouse_in', status: 'completed', quantity_completed: 5, defect_quantity: 0, start_time: '2023-10-02T08:00', end_time: '2023-10-02T10:00', pic_name: 'Budi', last_updated: '2023-10-02T10:00' },
                    { process: 'sanding', status: 'completed', quantity_completed: 5, defect_quantity: 1, start_time: '2023-10-02T10:30', end_time: '2023-10-02T14:00', pic_name: 'Ahmad', last_updated: '2023-10-02T14:00' },
                    { process: 'assembly', status: 'in_progress', quantity_completed: 3, defect_quantity: 0, start_time: '2023-10-03T08:00', end_time: null, pic_name: 'Sari', last_updated: '2023-10-05T16:30' },
                    { process: 'coloring', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'accessories', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'welding', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'inspection', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'coating', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'packaging', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'warehouse_out', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null }
                ]
            },
            {
                order_id: 'ORD-002',
                customer_name: 'CV Sejahtera',
                product_description: 'Kursi Kantor',
                quantity: 10,
                order_date: '2023-10-05',
                target_date: '2023-10-25',
                pic_name: 'Siti Rahayu',
                current_status: 'in_progress',
                notes: 'Warna hitam doff',
                requires_accessories: false,
                requires_welding: true,
                progress: 20,
                risk_level: 'HIGH',
                risk_score: 75,
                tracking: [
                    { process: 'warehouse_in', status: 'completed', quantity_completed: 10, defect_quantity: 0, start_time: '2023-10-06T08:00', end_time: '2023-10-06T09:30', pic_name: 'Budi', last_updated: '2023-10-06T09:30' },
                    { process: 'sanding', status: 'completed', quantity_completed: 10, defect_quantity: 0, start_time: '2023-10-06T10:00', end_time: '2023-10-06T15:00', pic_name: 'Ahmad', last_updated: '2023-10-06T15:00' },
                    { process: 'assembly', status: 'in_progress', quantity_completed: 2, defect_quantity: 0, start_time: '2023-10-09T08:00', end_time: null, pic_name: 'Sari', last_updated: '2023-10-10T12:00' },
                    { process: 'coloring', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'accessories', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'welding', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'inspection', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'coating', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'packaging', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null },
                    { process: 'warehouse_out', status: 'pending', quantity_completed: 0, defect_quantity: 0, start_time: null, end_time: null, pic_name: '', last_updated: null }
                ]
            }
        ];

        // Chart instances
        let progressChart = null;
        let processEfficiencyChart = null;
        let riskTimelineChart = null;
        let resourceAllocationChart = null;
        let combinedEfficiencyChart = null;
        let bottleneckChart = null;

        // Logo Customization Functions
        function openLogoModal() {
            const savedLogo = localStorage.getItem('companyLogo');
            if (savedLogo) {
                document.getElementById('logo-preview-image').src = savedLogo;
                document.getElementById('logo-preview').style.display = 'block';
            } else {
                document.getElementById('logo-preview').style.display = 'none';
            }
            
            document.getElementById('logoModal').classList.add('active');
        }

        function closeLogoModal() {
            document.getElementById('logoModal').classList.remove('active');
        }

        // Handle logo file upload
        document.getElementById('logo-upload-area').addEventListener('click', function() {
            document.getElementById('logo-file-input').click();
        });

        document.getElementById('logo-file-input').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.type.match('image.*')) {
                    showAlert('Please select an image file (PNG, JPG, JPEG)', 'error');
                    return;
                }

                if (file.size > 500 * 1024) {
                    showAlert('Logo image must be less than 500KB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('logo-preview-image').src = e.target.result;
                    document.getElementById('logo-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Drag and drop functionality
        document.getElementById('logo-upload-area').addEventListener('dragover', function(e) {
            e.preventDefault();
            e.currentTarget.style.borderColor = 'var(--primary-color)';
            e.currentTarget.style.background = 'rgba(26, 71, 42, 0.1)';
        });

        document.getElementById('logo-upload-area').addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.currentTarget.style.borderColor = 'var(--border-color)';
            e.currentTarget.style.background = '';
        });

        document.getElementById('logo-upload-area').addEventListener('drop', function(e) {
            e.preventDefault();
            e.currentTarget.style.borderColor = 'var(--border-color)';
            e.currentTarget.style.background = '';
            
            const file = e.dataTransfer.files[0];
            if (file) {
                if (!file.type.match('image.*')) {
                    showAlert('Please select an image file (PNG, JPG, JPEG)', 'error');
                    return;
                }

                if (file.size > 500 * 1024) {
                    showAlert('Logo image must be less than 500KB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('logo-preview-image').src = e.target.result;
                    document.getElementById('logo-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        function saveCompanyLogo() {
            const logoPreview = document.getElementById('logo-preview-image');
            
            if (logoPreview.src && !logoPreview.src.includes('data:')) {
                showAlert('Please upload a logo image first', 'error');
                return;
            }

            if (logoPreview.src) {
                localStorage.setItem('companyLogo', logoPreview.src);
                updateLogoDisplay(logoPreview.src);
                showAlert('Company logo saved successfully!', 'success');
                closeLogoModal();
            } else {
                showAlert('Please upload a logo image first', 'error');
            }
        }

        function removeCompanyLogo() {
            if (confirm('Are you sure you want to remove the company logo?')) {
                localStorage.removeItem('companyLogo');
                document.getElementById('header-logo-image').style.display = 'none';
                document.getElementById('company-name').style.display = 'flex';
                document.getElementById('footer-logo-image').style.display = 'none';
                document.getElementById('footer-company-name').style.display = 'block';
                document.getElementById('logo-preview').style.display = 'none';
                document.getElementById('logo-file-input').value = '';
                showAlert('Company logo removed successfully!', 'success');
                closeLogoModal();
            }
        }

        function updateLogoDisplay(logoData) {
            const headerLogo = document.getElementById('header-logo-image');
            headerLogo.src = logoData;
            headerLogo.style.display = 'block';
            document.getElementById('company-name').style.display = 'none';
            
            const footerLogo = document.getElementById('footer-logo-image');
            footerLogo.src = logoData;
            footerLogo.style.display = 'block';
            document.getElementById('footer-company-name').style.display = 'none';
        }

        // Load company logo from localStorage on startup
        function loadCompanyLogo() {
            const savedLogo = localStorage.getItem('companyLogo');
            if (savedLogo) {
                updateLogoDisplay(savedLogo);
            }
        }

        // Export Modal Functions
        function openExportModal() {
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        // Export to Excel function
        function exportToExcel(type) {
            try {
                let data = [];
                let filename = '';
                
                switch(type) {
                    case 'orders':
                        data = exportOrdersData();
                        filename = 'Production_Orders.xlsx';
                        break;
                    case 'tracking':
                        data = exportTrackingData();
                        filename = 'Production_Tracking.xlsx';
                        break;
                    case 'efficiency':
                        data = exportEfficiencyData();
                        filename = 'Efficiency_Report.xlsx';
                        break;
                    case 'all':
                        data = exportAllData();
                        filename = 'Complete_Production_Report.xlsx';
                        break;
                }
                
                const wb = XLSX.utils.book_new();
                
                if (Array.isArray(data)) {
                    data.forEach(sheet => {
                        const ws = XLSX.utils.json_to_sheet(sheet.data);
                        XLSX.utils.book_append_sheet(wb, ws, sheet.name);
                    });
                } else {
                    const ws = XLSX.utils.json_to_sheet(data);
                    XLSX.utils.book_append_sheet(wb, ws, 'Data');
                }
                
                XLSX.writeFile(wb, filename);
                showAlert(`Data exported successfully as ${filename}`, 'success');
                closeExportModal();
                
            } catch (error) {
                console.error('Error exporting data:', error);
                showAlert('Error exporting data', 'error');
            }
        }

        // Export data functions
        function exportOrdersData() {
            return orders.map(order => ({
                'Order ID': order.order_id,
                'Customer': order.customer_name,
                'Product': order.product_description,
                'Quantity': order.quantity,
                'Order Date': order.order_date,
                'Target Date': order.target_date,
                'Status': order.current_status,
                'Progress': `${order.progress}%`,
                'Risk Level': order.risk_level,
                'Risk Score': order.risk_score,
                'PIC': order.pic_name,
                'Notes': order.notes || '',
                'Requires Accessories': order.requires_accessories ? 'Yes' : 'No',
                'Requires Welding': order.requires_welding ? 'Yes' : 'No'
            }));
        }

        function exportTrackingData() {
            const trackingData = [];
            
            orders.forEach(order => {
                order.tracking.forEach(track => {
                    const process = productionProcesses.find(p => p.id === track.process);
                    trackingData.push({
                        'Order ID': order.order_id,
                        'Customer': order.customer_name,
                        'Process': process ? process.name : track.process,
                        'Status': track.status,
                        'Quantity Completed': track.quantity_completed,
                        'Defect Quantity': track.defect_quantity,
                        'Start Time': track.start_time || 'Not started',
                        'End Time': track.end_time || 'Not completed',
                        'PIC': track.pic_name || '',
                        'Last Updated': track.last_updated || 'Not updated'
                    });
                });
            });
            
            return trackingData;
        }

        function exportEfficiencyData() {
            const settings = loadEfficiencySettings();
            const efficiencyData = [];
            
            productionProcesses.forEach(process => {
                const setting = settings[process.id];
                if (setting) {
                    efficiencyData.push({
                        'Process': process.name,
                        'Target Time (hours)': setting.targetTime,
                        'Target Quality (%)': setting.targetQuality,
                        'Target Output (%)': setting.targetOutput,
                        'Criteria': setting.criteria.join('; ')
                    });
                }
            });
            
            return efficiencyData;
        }

        function exportAllData() {
            return [
                {
                    name: 'Orders',
                    data: exportOrdersData()
                },
                {
                    name: 'Tracking',
                    data: exportTrackingData()
                },
                {
                    name: 'Efficiency',
                    data: exportEfficiencyData()
                },
                {
                    name: 'Summary',
                    data: [
                        {
                            'Total Orders': orders.length,
                            'Orders In Progress': orders.filter(o => o.current_status === 'in_progress').length,
                            'Orders Completed': orders.filter(o => o.current_status === 'completed').length,
                            'Average Progress': `${(orders.reduce((sum, o) => sum + o.progress, 0) / orders.length).toFixed(1)}%`,
                            'Average Risk Score': (orders.reduce((sum, o) => sum + o.risk_score, 0) / orders.length).toFixed(1),
                            'Critical Orders': orders.filter(o => o.risk_level === 'CRITICAL').length
                        }
                    ]
                }
            ];
        }

        // Efficiency Settings Functions
        function loadEfficiencySettings() {
            const saved = localStorage.getItem('processEfficiencySettings');
            return saved ? JSON.parse(saved) : {...defaultEfficiencySettings};
        }

        function saveEfficiencySettings() {
            const settings = {};
            
            productionProcesses.forEach(process => {
                settings[process.id] = {
                    name: process.name,
                    targetTime: parseFloat(document.getElementById(`time-${process.id}`).value) || defaultEfficiencySettings[process.id].targetTime,
                    targetQuality: parseFloat(document.getElementById(`quality-${process.id}`).value) || defaultEfficiencySettings[process.id].targetQuality,
                    targetOutput: parseFloat(document.getElementById(`output-${process.id}`).value) || defaultEfficiencySettings[process.id].targetOutput,
                    criteria: defaultEfficiencySettings[process.id].criteria
                };
            });
            
            localStorage.setItem('processEfficiencySettings', JSON.stringify(settings));
            showAlert('Efficiency settings saved successfully!', 'success');
            loadEfficiencyPage();
        }

        function resetEfficiencySettings() {
            if (confirm('Are you sure you want to reset all efficiency settings to default?')) {
                localStorage.removeItem('processEfficiencySettings');
                loadEfficiencyPage();
                showAlert('Efficiency settings reset to default!', 'success');
            }
        }

        function loadEfficiencyPage() {
            const settings = loadEfficiencySettings();
            let html = '';
            
            productionProcesses.forEach(process => {
                const setting = settings[process.id];
                
                html += `
                    <div class="efficiency-item">
                        <div class="efficiency-header">
                            <div class="efficiency-title">
                                <i class="fas ${process.icon}"></i>
                                ${process.name}
                            </div>
                            <div>
                                <span style="font-size: 12px; color: #6c757d;">Adjust Targets:</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Target Time (hours)</label>
                                <input type="number" id="time-${process.id}" class="efficiency-input" 
                                       value="${setting.targetTime}" min="0.1" max="24" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label>Target Quality (%)</label>
                                <input type="number" id="quality-${process.id}" class="efficiency-input" 
                                       value="${setting.targetQuality}" min="0" max="100" step="1">
                            </div>
                            
                            <div class="form-group">
                                <label>Target Output (%)</label>
                                <input type="number" id="output-${process.id}" class="efficiency-input" 
                                       value="${setting.targetOutput}" min="0" max="100" step="1">
                            </div>
                        </div>
                        
                        <div class="criteria-list">
                            <strong>Efficiency Criteria:</strong>
                            <ul>
                                ${setting.criteria.map(criterion => `<li>${criterion}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('efficiency-settings').innerHTML = html;
        }

        // Order Management Functions
        function openOrderModal(orderId = null) {
            const modal = document.getElementById('orderModal');
            const title = document.getElementById('modal-title');
            const submitButton = document.getElementById('submit-button');
            const form = document.getElementById('order-form');
            
            if (orderId) {
                title.textContent = 'Edit Order';
                submitButton.textContent = 'Update Order';
                submitButton.innerHTML = '<i class="fas fa-save"></i> Update Order';
                
                const order = orders.find(o => o.order_id === orderId);
                if (order) {
                    document.getElementById('order-id').value = order.order_id;
                    document.querySelector('input[name="customer_name"]').value = order.customer_name;
                    document.querySelector('input[name="product_description"]').value = order.product_description;
                    document.querySelector('input[name="quantity"]').value = order.quantity;
                    document.querySelector('input[name="order_date"]').value = order.order_date;
                    document.querySelector('input[name="target_date"]').value = order.target_date;
                    document.querySelector('input[name="pic_name"]').value = order.pic_name;
                    document.querySelector('textarea[name="notes"]').value = order.notes || '';
                    document.getElementById('requires-accessories').checked = order.requires_accessories || false;
                    document.getElementById('requires-welding').checked = order.requires_welding || false;
                }
            } else {
                title.textContent = 'Create New Order';
                submitButton.textContent = 'Create Order';
                submitButton.innerHTML = '<i class="fas fa-plus"></i> Create Order';
                form.reset();
                document.getElementById('order-id').value = '';
                
                const today = new Date().toISOString().split('T')[0];
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + 14);
                const targetDateStr = targetDate.toISOString().split('T')[0];
                
                document.querySelector('input[name="order_date"]').value = today;
                document.querySelector('input[name="target_date"]').value = targetDateStr;
            }
            
            modal.classList.add('active');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        // Handle form submission for create and update
        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            const orderId = document.getElementById('order-id').value;

            try {
                if (orderId) {
                    const index = orders.findIndex(o => o.order_id === orderId);
                    if (index !== -1) {
                        orders[index] = {
                            ...orders[index],
                            customer_name: data.customer_name,
                            product_description: data.product_description,
                            quantity: parseInt(data.quantity),
                            order_date: data.order_date,
                            target_date: data.target_date,
                            pic_name: data.pic_name,
                            notes: data.notes,
                            requires_accessories: document.getElementById('requires-accessories').checked,
                            requires_welding: document.getElementById('requires-welding').checked
                        };
                        
                        const riskAssessment = calculateRiskAssessment(orders[index]);
                        orders[index].risk_level = riskAssessment.risk_level;
                        orders[index].risk_score = riskAssessment.risk_score;
                    }
                    showAlert('Order updated successfully', 'success');
                } else {
                    const newOrderId = 'ORD-' + String(orders.length + 1).padStart(3, '0');
                    const newOrder = {
                        order_id: newOrderId,
                        customer_name: data.customer_name,
                        product_description: data.product_description,
                        quantity: parseInt(data.quantity),
                        order_date: data.order_date,
                        target_date: data.target_date,
                        pic_name: data.pic_name,
                        current_status: 'pending',
                        notes: data.notes,
                        requires_accessories: document.getElementById('requires-accessories').checked,
                        requires_welding: document.getElementById('requires-welding').checked,
                        progress: 0,
                        risk_level: 'LOW',
                        risk_score: 10,
                        tracking: productionProcesses.map(process => ({
                            process: process.id,
                            status: 'pending',
                            quantity_completed: 0,
                            defect_quantity: 0,
                            start_time: null,
                            end_time: null,
                            pic_name: '',
                            issues: '',
                            last_updated: null
                        }))
                    };
                    orders.push(newOrder);
                    showAlert('Order created successfully', 'success');
                }
                
                closeOrderModal();
                loadOrders();
                loadDashboard();
            } catch (error) {
                console.error('Error:', error);
                showAlert(`Error ${orderId ? 'updating' : 'creating'} order`, 'error');
            }
        });

        function editOrder(orderId) {
            openOrderModal(orderId);
        }

        function deleteOrder(orderId) {
            if (confirm(`Are you sure you want to delete order ${orderId}?`)) {
                try {
                    orders = orders.filter(o => o.order_id !== orderId);
                    showAlert('Order deleted successfully', 'success');
                    loadOrders();
                    loadDashboard();
                } catch (error) {
                    console.error('Error:', error);
                    showAlert('Error deleting order', 'error');
                }
            }
        }

        // Tracking Form
        document.getElementById('tracking-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const orderId = document.getElementById('track-order-select').value;
            const processId = document.getElementById('track-process-select').value;
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const order = orders.find(o => o.order_id === orderId);
                if (order) {
                    const trackingIndex = order.tracking.findIndex(t => t.process === processId);
                    if (trackingIndex !== -1) {
                        const quantityCompleted = parseInt(data.quantity_completed) || 0;
                        const now = new Date().toISOString();
                        
                        order.tracking[trackingIndex] = {
                            ...order.tracking[trackingIndex],
                            quantity_completed: quantityCompleted,
                            defect_quantity: parseInt(data.defect_quantity) || 0,
                            start_time: data.start_time || order.tracking[trackingIndex].start_time || now,
                            end_time: data.end_time || order.tracking[trackingIndex].end_time,
                            pic_name: data.pic_name,
                            issues: data.issues,
                            last_updated: now
                        };

                        if (quantityCompleted === 0) {
                            order.tracking[trackingIndex].status = 'pending';
                        } else if (quantityCompleted === order.quantity) {
                            order.tracking[trackingIndex].status = 'completed';
                            if (!order.tracking[trackingIndex].end_time) {
                                order.tracking[trackingIndex].end_time = now;
                            }
                        } else {
                            order.tracking[trackingIndex].status = 'in_progress';
                        }

                        updateOrderStatus(order);

                        showAlert('Tracking updated successfully', 'success');
                        e.target.reset();
                        loadOrderTracking();
                        
                        if (document.getElementById('dss').classList.contains('active')) {
                            if (document.getElementById('dss-single').classList.contains('active')) {
                                analyzeOrder();
                            } else {
                                analyzeAllOrders();
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Error updating tracking', 'error');
            }
        });

        // Risk Assessment Function
        function calculateRiskAssessment(order) {
            const today = new Date();
            const targetDate = new Date(order.target_date);
            const orderDate = new Date(order.order_date);
            
            const daysUntilDue = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
            const daysSinceOrder = Math.ceil((today - orderDate) / (1000 * 60 * 60 * 24));
            const totalDaysAllocated = Math.ceil((targetDate - orderDate) / (1000 * 60 * 60 * 24));
            
            const timeUsedRatio = daysSinceOrder / totalDaysAllocated;
            const timePressure = Math.max(0, Math.min(100, (timeUsedRatio - (order.progress / 100)) * 100));
            
            const progressRisk = 100 - order.progress;
            
            const totalDefects = order.tracking.reduce((sum, process) => sum + process.defect_quantity, 0);
            const defectRate = (totalDefects / order.quantity) * 100;
            const defectRisk = Math.min(100, defectRate * 10);
            
            let bottleneckRisk = 0;
            const completedProcesses = order.tracking.filter(p => p.quantity_completed === order.quantity).length;
            const expectedProcesses = Math.ceil((order.progress / 100) * order.tracking.length);
            if (completedProcesses < expectedProcesses - 2) {
                bottleneckRisk = 50;
            }
            
            const finalRiskScore = Math.min(100, 
                (progressRisk * 0.4) + 
                (timePressure * 0.3) + 
                (defectRisk * 0.2) +
                (bottleneckRisk * 0.1)
            );
            
            let riskLevel;
            if (finalRiskScore >= 80 || daysUntilDue < 0) {
                riskLevel = 'CRITICAL';
            } else if (finalRiskScore >= 60) {
                riskLevel = 'HIGH';
            } else if (finalRiskScore >= 40) {
                riskLevel = 'MEDIUM';
            } else if (finalRiskScore >= 20) {
                riskLevel = 'LOW';
            } else {
                riskLevel = 'VERY LOW';
            }
            
            if (daysSinceOrder < 2 && order.progress === 0) {
                riskLevel = 'LOW';
            }
            
            return {
                risk_level: riskLevel,
                risk_score: Math.round(finalRiskScore),
                days_until_due: daysUntilDue,
                time_pressure: Math.round(timePressure),
                defect_rate: defectRate
            };
        }

        // Update Order Status
        function updateOrderStatus(order) {
            const applicableProcesses = productionProcesses.filter(process => {
                if (process.optional) {
                    if (process.id === 'accessories') return order.requires_accessories;
                    if (process.id === 'welding') return order.requires_welding;
                }
                return true;
            });

            const completedProcesses = applicableProcesses.filter(process => {
                const tracking = order.tracking.find(t => t.process === process.id);
                return tracking && tracking.quantity_completed === order.quantity;
            }).length;

            order.progress = Math.round((completedProcesses / applicableProcesses.length) * 100);

            const warehouseOut = order.tracking.find(t => t.process === 'warehouse_out');
            
            if (warehouseOut && warehouseOut.quantity_completed === order.quantity) {
                order.current_status = 'completed';
            } else if (order.tracking.some(t => t.quantity_completed > 0 && t.quantity_completed < order.quantity)) {
                order.current_status = 'in_progress';
            } else {
                order.current_status = 'pending';
            }
            
            const riskAssessment = calculateRiskAssessment(order);
            order.risk_level = riskAssessment.risk_level;
            order.risk_score = riskAssessment.risk_score;
        }

        // DSS Analysis Functions
        function showDssTab(tabName) {
            document.querySelectorAll('.dss-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.dss-tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.dss-tab:nth-child(${tabName === 'single' ? 1 : 2})`).classList.add('active');
            document.getElementById(`dss-${tabName}`).classList.add('active');
            
            if (tabName === 'combined') {
                analyzeAllOrders();
            }
        }

        function analyzeOrder() {
            const orderId = document.getElementById('dss-order-select').value;
            if (!orderId) return;

            try {
                const order = orders.find(o => o.order_id === orderId);
                if (!order) return;

                const riskAssessment = calculateRiskAssessment(order);
                order.risk_level = riskAssessment.risk_level;
                order.risk_score = riskAssessment.risk_score;

                const processEfficiency = updateEfficiencyCalculation(order);

                let html = `
                    <div class="dss-grid">
                        <div class="dss-card risk">
                            <h4><i class="fas fa-exclamation-triangle"></i> Risk Assessment</h4>
                            <div class="kpi-value" style="color: ${riskAssessment.risk_level === 'CRITICAL' ? 'var(--danger-color)' : riskAssessment.risk_level === 'HIGH' ? 'var(--warning-color)' : 'var(--info-color)'}">${riskAssessment.risk_level}</div>
                            <div class="kpi-label">Risk Score: ${riskAssessment.risk_score}/100</div>
                            <div class="kpi-label">Days Until Due: ${riskAssessment.days_until_due}</div>
                        </div>
                        <div class="dss-card forecast">
                            <h4><i class="fas fa-clock"></i> Forecast</h4>
                            <div class="kpi-value">${new Date(Date.now() + (100 - order.progress) * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
                            <div class="kpi-label">Estimated Completion</div>
                            <div class="kpi-label">Hours Remaining: ${(100 - order.progress) * 2.4}</div>
                        </div>
                        <div class="dss-card efficiency">
                            <h4><i class="fas fa-tachometer-alt"></i> Efficiency</h4>
                            <div class="kpi-value">${order.progress}%</div>
                            <div class="kpi-label">Current Progress</div>
                            <div class="kpi-label">On Track: ${riskAssessment.days_until_due > 0 ? 'YES' : 'NO'}</div>
                        </div>
                    </div>

                    <div class="chart-row">
                        <div class="chart-container">
                            <h4>Order Progress vs Time</h4>
                            <canvas id="progressChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4>Process Efficiency</h4>
                            <canvas id="processEfficiencyChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-row">
                        <div class="chart-container">
                            <h4>Risk Timeline</h4>
                            <canvas id="riskTimelineChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4>Resource Allocation</h4>
                            <canvas id="resourceAllocationChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-row">
                        <div class="chart-container chart-full">
                            <h4>Process Flow Analysis</h4>
                            <canvas id="processFlowChart"></canvas>
                        </div>
                    </div>

                    <div class="table-container" style="margin-top: 24px;">
                        <div style="padding: 20px;">
                            <h3><i class="fas fa-lightbulb"></i> Recommendations</h3>
                            <div style="margin-top: 16px;">
                                ${generateRecommendations(order, riskAssessment).map(rec => `
                                    <div class="recommendation-item">
                                        <span class="recommendation-priority priority-${rec.priority.toLowerCase()}">${rec.priority}</span>
                                        ${rec.action}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('dss-results').innerHTML = html;

                renderProgressChart(order);
                renderProcessEfficiencyChart(processEfficiency);
                renderRiskTimelineChart(order);
                renderResourceAllocationChart(order);
                renderProcessFlowChart(order);

            } catch (error) {
                console.error('Error analyzing order:', error);
                showAlert('Error analyzing order', 'error');
            }
        }

        function analyzeAllOrders() {
            try {
                const totalOrders = orders.length;
                const completedOrders = orders.filter(o => o.current_status === 'completed').length;
                const inProgressOrders = orders.filter(o => o.current_status === 'in_progress').length;
                const pendingOrders = orders.filter(o => o.current_status === 'pending').length;
                
                const avgProgress = orders.reduce((sum, order) => sum + order.progress, 0) / totalOrders;
                const avgRiskScore = orders.reduce((sum, order) => sum + order.risk_score, 0) / totalOrders;
                
                const processEfficiency = {};
                productionProcesses.forEach(process => {
                    let totalEfficiency = 0;
                    let count = 0;
                    
                    orders.forEach(order => {
                        const tracking = order.tracking.find(t => t.process === process.id);
                        if (tracking && tracking.start_time && tracking.end_time) {
                            const start = new Date(tracking.start_time);
                            const end = new Date(tracking.end_time);
                            const actualTime = (end - start) / (1000 * 60 * 60);
                            
                            const quality = Math.max(0, 100 - ((tracking.defect_quantity / order.quantity) * 100));
                            const output = (tracking.quantity_completed / order.quantity) * 100;
                            
                            totalEfficiency += calculateProcessEfficiency(process.id, actualTime, quality, output);
                            count++;
                        } else if (tracking && tracking.quantity_completed > 0) {
                            totalEfficiency += 50;
                            count++;
                        }
                    });
                    
                    processEfficiency[process.id] = count > 0 ? totalEfficiency / count : 0;
                });

                const bottleneckAnalysis = analyzeBottlenecks();
                
                let html = `
                    <div class="dss-grid">
                        <div class="dss-card risk">
                            <h4><i class="fas fa-chart-pie"></i> Order Distribution</h4>
                            <div class="kpi-value">${totalOrders}</div>
                            <div class="kpi-label">Total Orders</div>
                            <div class="kpi-label">Completed: ${completedOrders}</div>
                            <div class="kpi-label">In Progress: ${inProgressOrders}</div>
                        </div>
                        <div class="dss-card forecast">
                            <h4><i class="fas fa-tachometer-alt"></i> Overall Performance</h4>
                            <div class="kpi-value">${avgProgress.toFixed(1)}%</div>
                            <div class="kpi-label">Average Progress</div>
                            <div class="kpi-label">Avg Risk: ${avgRiskScore.toFixed(1)}/100</div>
                        </div>
                        <div class="dss-card efficiency">
                            <h4><i class="fas fa-exclamation-triangle"></i> Risk Overview</h4>
                            <div class="kpi-value" style="color: ${avgRiskScore > 70 ? 'var(--danger-color)' : avgRiskScore > 50 ? 'var(--warning-color)' : 'var(--success-color)'}">${avgRiskScore > 70 ? 'HIGH' : avgRiskScore > 50 ? 'MEDIUM' : 'LOW'}</div>
                            <div class="kpi-label">Overall Risk Level</div>
                            <div class="kpi-label">Critical Orders: ${orders.filter(o => o.risk_level === 'CRITICAL').length}</div>
                        </div>
                    </div>

                    <div class="chart-row">
                        <div class="chart-container">
                            <h4>Process Efficiency Across All Orders</h4>
                            <canvas id="combinedEfficiencyChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h4>Production Bottlenecks</h4>
                            <canvas id="bottleneckChart"></canvas>
                        </div>
                    </div>

                    <div class="table-container" style="margin-top: 24px;">
                        <div style="padding: 20px;">
                            <h3><i class="fas fa-lightbulb"></i> Overall Recommendations</h3>
                            <div style="margin-top: 16px;">
                                ${generateCombinedRecommendations(avgRiskScore, bottleneckAnalysis).map(rec => `
                                    <div class="recommendation-item">
                                        <span class="recommendation-priority priority-${rec.priority.toLowerCase()}">${rec.priority}</span>
                                        ${rec.action}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('combined-results').innerHTML = html;

                renderCombinedEfficiencyChart(processEfficiency);
                renderBottleneckChart(bottleneckAnalysis);

            } catch (error) {
                console.error('Error analyzing all orders:', error);
                showAlert('Error analyzing all orders', 'error');
            }
        }

        // Utility Functions
        function calculateProcessEfficiency(processId, actualTime, actualQuality, actualOutput) {
            const settings = loadEfficiencySettings();
            const setting = settings[processId];
            if (!setting) return 0;
            
            const timeEfficiency = Math.max(0, (setting.targetTime / actualTime) * 100);
            const qualityEfficiency = actualQuality;
            const outputEfficiency = actualOutput;
            
            const overallEfficiency = (timeEfficiency * 0.4) + (qualityEfficiency * 0.4) + (outputEfficiency * 0.2);
            
            return Math.min(100, overallEfficiency);
        }

        function updateEfficiencyCalculation(order) {
            const processEfficiency = {};
            
            productionProcesses.forEach(process => {
                const tracking = order.tracking.find(t => t.process === process.id);
                if (tracking && tracking.start_time && tracking.end_time) {
                    const start = new Date(tracking.start_time);
                    const end = new Date(tracking.end_time);
                    const actualTime = (end - start) / (1000 * 60 * 60);
                    
                    const quality = Math.max(0, 100 - ((tracking.defect_quantity / order.quantity) * 100));
                    const output = (tracking.quantity_completed / order.quantity) * 100;
                    
                    processEfficiency[process.id] = calculateProcessEfficiency(process.id, actualTime, quality, output);
                } else if (tracking && tracking.quantity_completed > 0) {
                    processEfficiency[process.id] = 50;
                } else {
                    processEfficiency[process.id] = 0;
                }
            });
            
            return processEfficiency;
        }

        function analyzeBottlenecks() {
            const processDelays = {};
            
            productionProcesses.forEach(process => {
                let totalDelay = 0;
                let count = 0;
                
                orders.forEach(order => {
                    const tracking = order.tracking.find(t => t.process === process.id);
                    if (tracking && tracking.start_time && tracking.end_time) {
                        const start = new Date(tracking.start_time);
                        const end = new Date(tracking.end_time);
                        const duration = (end - start) / (1000 * 60 * 60);
                        
                        const settings = loadEfficiencySettings();
                        const expectedDuration = settings[process.id]?.targetTime || 2;
                        const delay = Math.max(0, duration - expectedDuration);
                        totalDelay += delay;
                        count++;
                    }
                });
                
                processDelays[process.id] = count > 0 ? totalDelay / count : 0;
            });
            
            return processDelays;
        }

        function generateRecommendations(order, riskAssessment) {
            const recommendations = [];
            
            if (riskAssessment.risk_level === 'CRITICAL') {
                recommendations.push({ priority: 'HIGH', action: 'Immediate intervention required. Allocate additional resources to meet deadline.' });
            }
            
            if (riskAssessment.days_until_due < 3) {
                recommendations.push({ priority: 'HIGH', action: 'Deadline approaching. Consider overtime or temporary workforce.' });
            }
            
            if (order.progress < 30 && riskAssessment.time_pressure > 50) {
                recommendations.push({ priority: 'HIGH', action: 'Progress is behind schedule. Review process bottlenecks.' });
            }
            
            if (riskAssessment.defect_rate > 5) {
                recommendations.push({ priority: 'MEDIUM', action: 'High defect rate detected. Improve quality control measures.' });
            }
            
            const assembly = order.tracking.find(t => t.process === 'assembly');
            if (assembly && assembly.quantity_completed < order.quantity * 0.5 && order.progress > 30) {
                recommendations.push({ priority: 'MEDIUM', action: 'Assembly process is lagging. Review workflow and resource allocation.' });
            }
            
            if (order.requires_welding) {
                const welding = order.tracking.find(t => t.process === 'welding');
                if (welding && welding.quantity_completed === 0 && order.progress > 40) {
                    recommendations.push({ priority: 'MEDIUM', action: 'Welding process not started. Ensure welding team is available.' });
                }
            }
            
            if (recommendations.length === 0) {
                recommendations.push({ priority: 'LOW', action: 'Order is on track. Continue monitoring progress.' });
            }
            
            return recommendations;
        }

        function generateCombinedRecommendations(avgRiskScore, bottleneckAnalysis) {
            const recommendations = [];
            
            if (avgRiskScore > 70) {
                recommendations.push({ priority: 'HIGH', action: 'Overall risk is high. Review all critical orders and allocate resources accordingly.' });
            }
            
            let maxDelay = 0;
            let bottleneckProcess = '';
            
            for (const [process, delay] of Object.entries(bottleneckAnalysis)) {
                if (delay > maxDelay) {
                    maxDelay = delay;
                    bottleneckProcess = process;
                }
            }
            
            if (maxDelay > 4) {
                const processName = productionProcesses.find(p => p.id === bottleneckProcess)?.name || bottleneckProcess;
                recommendations.push({ priority: 'HIGH', action: `Significant bottleneck detected at ${processName}. Average delay: ${maxDelay.toFixed(1)} hours.` });
            } else if (maxDelay > 2) {
                const processName = productionProcesses.find(p => p.id === bottleneckProcess)?.name || bottleneckProcess;
                recommendations.push({ priority: 'MEDIUM', action: `Moderate bottleneck at ${processName}. Consider process optimization.` });
            }
            
            const assemblyEfficiency = bottleneckAnalysis['assembly'] || 0;
            if (assemblyEfficiency > 3) {
                recommendations.push({ priority: 'MEDIUM', action: 'Assembly process consistently delayed. Review workflow and staffing.' });
            }
            
            if (recommendations.length === 0) {
                recommendations.push({ priority: 'LOW', action: 'Production is running smoothly. Continue current operations.' });
            }
            
            return recommendations;
        }

        // Chart rendering functions
        function renderProgressChart(order) {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Actual Progress',
                        data: [10, 25, 40, order.progress],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Planned Progress',
                        data: [25, 50, 75, 100],
                        borderColor: '#4cc9f0',
                        borderDash: [5, 5],
                        backgroundColor: 'transparent',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            ticks: { callback: function(value) { return value + '%'; } }
                        }
                    }
                }
            });
        }

        function renderProcessEfficiencyChart(efficiencyData) {
            const ctx = document.getElementById('processEfficiencyChart').getContext('2d');
            
            if (processEfficiencyChart) {
                processEfficiencyChart.destroy();
            }
            
            const processNames = productionProcesses.map(p => p.name);
            const efficiencyValues = productionProcesses.map(p => efficiencyData[p.id] || 0);
            
            processEfficiencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: processNames,
                    datasets: [{
                        label: 'Efficiency (%)',
                        data: efficiencyValues,
                        backgroundColor: 'rgba(67, 97, 238, 0.7)',
                        borderColor: '#4361ee',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(value) { return value + '%'; } }
                        }
                    }
                }
            });
        }

        function renderRiskTimelineChart(order) {
            const ctx = document.getElementById('riskTimelineChart').getContext('2d');
            
            if (riskTimelineChart) {
                riskTimelineChart.destroy();
            }
            
            riskTimelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Start', 'Week 1', 'Week 2', 'Week 3', 'Current'],
                    datasets: [{
                        label: 'Risk Level',
                        data: [20, 25, 45, 65, order.risk_score],
                        borderColor: '#f72585',
                        backgroundColor: 'rgba(247, 37, 133, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            ticks: { callback: function(value) { return value + '%'; } }
                        }
                    }
                }
            });
        }

        function renderResourceAllocationChart(order) {
            const ctx = document.getElementById('resourceAllocationChart').getContext('2d');
            
            if (resourceAllocationChart) {
                resourceAllocationChart.destroy();
            }
            
            const allocationData = {};
            let totalTime = 0;
            
            order.tracking.forEach(process => {
                if (process.start_time && process.end_time) {
                    const start = new Date(process.start_time);
                    const end = new Date(process.end_time);
                    const duration = (end - start) / (1000 * 60 * 60);
                    allocationData[process.process] = duration;
                    totalTime += duration;
                }
            });
            
            const allocationPercentages = {};
            for (const [process, time] of Object.entries(allocationData)) {
                allocationPercentages[process] = (time / totalTime) * 100;
            }
            
            const processNames = [];
            const percentages = [];
            
            productionProcesses.forEach(process => {
                if (allocationPercentages[process.id]) {
                    processNames.push(process.name);
                    percentages.push(allocationPercentages[process.id]);
                }
            });
            
            resourceAllocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: processNames,
                    datasets: [{
                        data: percentages,
                        backgroundColor: [
                            'rgba(67, 97, 238, 0.7)', 'rgba(76, 201, 240, 0.7)', 'rgba(248, 150, 30, 0.7)',
                            'rgba(72, 149, 239, 0.7)', 'rgba(39, 174, 96, 0.7)', 'rgba(231, 76, 60, 0.7)',
                            'rgba(155, 89, 182, 0.7)', 'rgba(52, 152, 219, 0.7)', 'rgba(241, 196, 15, 0.7)',
                            'rgba(46, 204, 113, 0.7)'
                        ],
                        borderColor: [
                            '#4361ee', '#4cc9f0', '#f8961e', '#4895ef', '#27ae60',
                            '#e74c3c', '#9b59b6', '#3498db', '#f1c40f', '#2ecc71'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function renderProcessFlowChart(order) {
            const ctx = document.getElementById('processFlowChart').getContext('2d');
            
            const applicableProcesses = productionProcesses.filter(process => {
                if (process.optional) {
                    if (process.id === 'accessories') return order.requires_accessories;
                    if (process.id === 'welding') return order.requires_welding;
                }
                return true;
            });
            
            const processLabels = applicableProcesses.map(p => p.name);
            const completionData = applicableProcesses.map(p => {
                const tracking = order.tracking.find(t => t.process === p.id) || { status: 'pending', quantity_completed: 0 };
                return (tracking.quantity_completed / order.quantity) * 100;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: processLabels,
                    datasets: [{
                        label: 'Completion Rate (%)',
                        data: completionData,
                        backgroundColor: completionData.map(value => {
                            if (value === 100) return 'rgba(76, 201, 240, 0.7)';
                            if (value > 50) return 'rgba(248, 150, 30, 0.7)';
                            return 'rgba(247, 37, 133, 0.7)';
                        }),
                        borderColor: completionData.map(value => {
                            if (value === 100) return '#4cc9f0';
                            if (value > 50) return '#f8961e';
                            return '#f72585';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(value) { return value + '%'; } }
                        }
                    }
                }
            });
        }

        function renderCombinedEfficiencyChart(efficiencyData) {
            const ctx = document.getElementById('combinedEfficiencyChart').getContext('2d');
            
            if (combinedEfficiencyChart) {
                combinedEfficiencyChart.destroy();
            }
            
            const processNames = productionProcesses.map(p => p.name);
            const efficiencyValues = productionProcesses.map(p => efficiencyData[p.id] || 0);
            
            combinedEfficiencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: processNames,
                    datasets: [{
                        label: 'Average Efficiency (%)',
                        data: efficiencyValues,
                        backgroundColor: 'rgba(67, 97, 238, 0.7)',
                        borderColor: '#4361ee',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(value) { return value + '%'; } }
                        }
                    }
                }
            });
        }

        function renderBottleneckChart(bottleneckData) {
            const ctx = document.getElementById('bottleneckChart').getContext('2d');
            
            if (bottleneckChart) {
                bottleneckChart.destroy();
            }
            
            const processNames = productionProcesses.map(p => p.name);
            const delayValues = productionProcesses.map(p => bottleneckData[p.id] || 0);
            
            bottleneckChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: processNames,
                    datasets: [{
                        label: 'Average Delay (hours)',
                        data: delayValues,
                        backgroundColor: delayValues.map(value => {
                            if (value > 4) return 'rgba(231, 76, 60, 0.7)';
                            if (value > 2) return 'rgba(243, 156, 18, 0.7)';
                            return 'rgba(39, 174, 96, 0.7)';
                        }),
                        borderColor: delayValues.map(value => {
                            if (value > 4) return '#e74c3c';
                            if (value > 2) return '#f39c12';
                            return '#27ae60';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'orders') {
                loadOrders();
            } else if (tabName === 'tracking') {
                loadOrdersForTracking();
            } else if (tabName === 'dss') {
                loadOrdersForDSS();
            } else if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'efficiency') {
                loadEfficiencyPage();
            }
        }

        // Load data functions
        function loadDashboard() {
            try {
                orders.forEach(order => {
                    const riskAssessment = calculateRiskAssessment(order);
                    order.risk_level = riskAssessment.risk_level;
                    order.risk_score = riskAssessment.risk_score;
                });

                const totalOrders = orders.length;
                const inProgressOrders = orders.filter(o => o.current_status === 'in_progress').length;
                const completedOrders = orders.filter(o => o.current_status === 'completed').length;
                const criticalOrders = orders.filter(o => o.risk_level === 'CRITICAL').length;
                
                const avgProgress = orders.reduce((sum, order) => sum + order.progress, 0) / totalOrders;
                const avgLeadTime = 48;
                const defectRate = 2.5;

                document.getElementById('total-orders').textContent = totalOrders;
                document.getElementById('in-progress').textContent = inProgressOrders;
                document.getElementById('completed-orders').textContent = avgProgress.toFixed(1) + '%';
                document.getElementById('at-risk').textContent = criticalOrders;
                document.getElementById('avg-lead-time').textContent = avgLeadTime;
                document.getElementById('defect-rate').textContent = defectRate + '%';

                let riskHtml = '';
                const atRiskOrders = orders.filter(o => o.risk_level === 'CRITICAL' || o.risk_level === 'HIGH');
                
                atRiskOrders.forEach(order => {
                    const riskColor = order.risk_level === 'CRITICAL' ? 'danger' : 
                                    order.risk_level === 'HIGH' ? 'warning' : 
                                    order.risk_level === 'MEDIUM' ? 'info' : 'success';
                    
                    riskHtml += `
                        <tr>
                            <td><strong>${order.order_id}</strong></td>
                            <td>${order.customer_name}</td>
                            <td><span class="badge badge-${riskColor}">${order.risk_level}</span></td>
                            <td>${order.risk_score}</td>
                            <td><button class="btn btn-primary btn-sm" onclick="analyzeOrderDirect('${order.order_id}')">Analyze</button></td>
                        </tr>
                    `;
                });

                document.getElementById('risk-orders-table').innerHTML = riskHtml || '<tr><td colspan="5">No at-risk orders</td></tr>';

                const bottleneck = detectBottleneck();
                document.getElementById('bottleneck-stage').textContent = bottleneck.workstation;
                document.getElementById('bottleneck-risk').textContent = bottleneck.risk_level;

                const bottleneckColor = bottleneck.risk_level === 'HIGH' ? 'danger' : 'warning';
                const bottleneckAlert = `
                    <div class="risk-card">
                        <h4><i class="fas fa-exclamation-triangle"></i> Production Bottleneck Detected</h4>
                        <p>
                            <strong>Workstation:</strong> ${bottleneck.workstation}<br>
                            <strong>Average Duration:</strong> ${bottleneck.avg_duration} hours<br>
                            <strong>Risk Level:</strong> <span class="badge badge-${bottleneckColor}">${bottleneck.risk_level}</span><br>
                            <strong>Action:</strong> ${bottleneck.recommendation}
                        </p>
                    </div>
                `;
                document.getElementById('bottleneck-alert').innerHTML = bottleneckAlert;

            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        function detectBottleneck() {
            const slowProcesses = {};
            
            orders.forEach(order => {
                order.tracking.forEach(process => {
                    if (process.start_time && process.end_time) {
                        const start = new Date(process.start_time);
                        const end = new Date(process.end_time);
                        const duration = (end - start) / (1000 * 60 * 60);
                        
                        if (!slowProcesses[process.process] || duration > slowProcesses[process.process].duration) {
                            slowProcesses[process.process] = {
                                duration: duration,
                                count: 1
                            };
                        } else {
                            slowProcesses[process.process].count++;
                        }
                    }
                });
            });
            
            let bottleneck = { workstation: 'None', avg_duration: 0, risk_level: 'LOW' };
            for (const [process, data] of Object.entries(slowProcesses)) {
                const avgDuration = data.duration / data.count;
                if (avgDuration > bottleneck.avg_duration) {
                    const processName = productionProcesses.find(p => p.id === process)?.name || process;
                    bottleneck = {
                        workstation: processName,
                        avg_duration: avgDuration.toFixed(1),
                        risk_level: avgDuration > 8 ? 'HIGH' : 'MEDIUM',
                        recommendation: avgDuration > 8 ? 
                            'Increase resources or review processes at this workstation' :
                            'Monitor this process for potential delays'
                    };
                }
            }
            
            return bottleneck;
        }

        function loadOrders() {
            try {
                let html = '';
                orders.forEach(order => {
                    const statusColor = order.current_status === 'completed' ? 'success' : 
                                      order.current_status === 'in_progress' ? 'info' : 
                                      order.current_status === 'on_hold' ? 'warning' : 'accent';
                    
                    const progressColor = order.progress > 80 ? 'progress-success' : 
                                        order.progress > 50 ? 'progress-warning' : 
                                        'progress-danger';
                    
                    const riskColor = order.risk_level === 'CRITICAL' ? 'danger' : 
                                   order.risk_level === 'HIGH' ? 'warning' : 
                                   order.risk_level === 'MEDIUM' ? 'info' : 'success';
                    
                    html += `
                        <tr>
                            <td><strong>${order.order_id}</strong></td>
                            <td>${order.customer_name}</td>
                            <td>${order.product_description}</td>
                            <td>${order.quantity}</td>
                            <td>${order.order_date}</td>
                            <td>${order.target_date}</td>
                            <td><span class="badge badge-${statusColor}">${order.current_status}</span></td>
                            <td>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill ${progressColor}" style="width: ${order.progress}%"></div>
                                    </div>
                                    <span class="progress-text">${order.progress}%</span>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-primary btn-sm" onclick="editOrder('${order.order_id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-${riskColor} btn-sm" onclick="viewOrderRisk('${order.order_id}')">
                                        <i class="fas fa-chart-line"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteOrder('${order.order_id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                document.getElementById('orders-table').innerHTML = html || '<tr><td colspan="9">No orders found</td></tr>';

            } catch (error) {
                console.error('Error loading orders:', error);
                showAlert('Error loading orders', 'error');
            }
        }

        function loadOrdersForTracking() {
            try {
                let html = '<option value="">-- Select Order --</option>';
                orders.filter(o => o.current_status !== 'completed').forEach(order => {
                    html += `<option value="${order.order_id}">${order.order_id} - ${order.customer_name}</option>`;
                });

                document.getElementById('track-order-select').innerHTML = html;

            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function loadOrdersForDSS() {
            try {
                let html = '<option value="">-- Select Order --</option>';
                orders.forEach(order => {
                    html += `<option value="${order.order_id}">${order.order_id} - ${order.customer_name}</option>`;
                });

                document.getElementById('dss-order-select').innerHTML = html;

            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }

        function loadOrderTracking() {
            const orderId = document.getElementById('track-order-select').value;
            if (!orderId) {
                document.getElementById('order-tracking-info').style.display = 'none';
                return;
            }

            const order = orders.find(o => o.order_id === orderId);
            if (!order) return;

            document.getElementById('order-tracking-info').style.display = 'block';

            const now = new Date();
            const nowFormatted = now.toISOString().slice(0, 16);
            document.getElementById('start-time').value = nowFormatted;

            let processStepsHtml = '';
            let completedSteps = 0;
            let activeStepIndex = -1;

            const applicableProcesses = productionProcesses.filter(process => {
                if (process.optional) {
                    if (process.id === 'accessories') return order.requires_accessories;
                    if (process.id === 'welding') return order.requires_welding;
                }
                return true;
            });

            applicableProcesses.forEach((process, index) => {
                const tracking = order.tracking.find(t => t.process === process.id) || { status: 'pending', quantity_completed: 0 };
                let stepClass = '';
                
                if (tracking.quantity_completed === order.quantity) {
                    stepClass = 'step-completed';
                    completedSteps++;
                } else if (tracking.quantity_completed > 0) {
                    stepClass = 'step-active';
                    if (activeStepIndex === -1) activeStepIndex = index;
                }

                processStepsHtml += `
                    <div class="process-step ${stepClass}" data-process="${process.id}">
                        <div class="step-icon">
                            <i class="fas ${process.icon}"></i>
                        </div>
                        <div class="step-label">${process.name}</div>
                    </div>
                `;
            });

            document.getElementById('process-steps').innerHTML = processStepsHtml;

            const connectorWidth = activeStepIndex !== -1 ? 
                (activeStepIndex / (applicableProcesses.length - 1)) * 100 : 
                (completedSteps / applicableProcesses.length) * 100;
            
            let connector = document.querySelector('.process-connector');
            if (!connector) {
                connector = document.createElement('div');
                connector.className = 'process-connector';
                document.getElementById('process-steps').appendChild(connector);
            }
            connector.style.width = `${connectorWidth}%`;

            let quantityTableHtml = `
                <table class="quantity-table">
                    <thead>
                        <tr>
                            <th>Process</th>
                            <th>Status</th>
                            <th>Quantity Completed</th>
                            <th>Defect Quantity</th>
                            <th>Remaining</th>
                            <th>Last Updated</th>
                            <th>PIC</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            applicableProcesses.forEach(process => {
                const tracking = order.tracking.find(t => t.process === process.id) || { 
                    status: 'pending', 
                    quantity_completed: 0, 
                    defect_quantity: 0,
                    pic_name: '',
                    last_updated: null
                };
                
                const remaining = order.quantity - tracking.quantity_completed;
                const statusClass = tracking.quantity_completed === order.quantity ? 'status-completed' : 
                                  tracking.quantity_completed > 0 ? 'status-in-progress' : 'status-pending';
                
                const statusText = tracking.quantity_completed === order.quantity ? 'COMPLETED' : 
                                 tracking.quantity_completed > 0 ? 'IN PROGRESS' : 'PENDING';
                
                const lastUpdated = tracking.last_updated ? 
                    new Date(tracking.last_updated).toLocaleString() : '-';
                
                quantityTableHtml += `
                    <tr>
                        <td>${process.name}</td>
                        <td><span class="process-status ${statusClass}">${statusText}</span></td>
                        <td>${tracking.quantity_completed}</td>
                        <td>${tracking.defect_quantity}</td>
                        <td>${remaining}</td>
                        <td>${lastUpdated}</td>
                        <td>${tracking.pic_name || '-'}</td>
                    </tr>
                `;
            });

            quantityTableHtml += '</tbody></table>';
            document.getElementById('quantity-tracking-table').innerHTML = quantityTableHtml;

            let processSelectHtml = '';
            applicableProcesses.forEach(process => {
                processSelectHtml += `<option value="${process.id}">${process.name}</option>`;
            });
            document.getElementById('track-process-select').innerHTML = processSelectHtml;

            document.getElementById('quantity-completed').max = order.quantity;
            document.getElementById('defect-quantity').max = order.quantity;
        }

        function viewOrderRisk(orderId) {
            const order = orders.find(o => o.order_id === orderId);
            if (!order) return;
            
            const riskAssessment = calculateRiskAssessment(order);
            
            document.getElementById('dss-order-select').value = orderId;
            showTab('dss');
            analyzeOrder();
        }

        function analyzeOrderDirect(orderId) {
            document.getElementById('dss-order-select').value = orderId;
            showTab('dss');
            showDssTab('single');
            analyzeOrder();
        }

        // Alert function
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            
            const icon = type === 'success' ? 'check-circle' : 'exclamation-triangle';
            alert.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
            
            document.getElementById('alert-container').appendChild(alert);

            setTimeout(() => alert.remove(), 4000);
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadCompanyLogo();
            loadDashboard();
        });
    </script>
</body>
</html>